<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<title>é…å°æ¸¬è©¦é é¢</title>
</head>
<body>
	<h2>Match æ¸¬è©¦</h2>
	<button onclick="sendMatch('like', 9)">å–œæ­¡</button>
	<button onclick="sendMatch('dislike', 9)">ä¸å–œæ­¡</button>

	<h2>èŠå¤©å®¤æ¸…å–®</h2>
	<ul id="chatRoomList"></ul>

	<script>
    function sendMatch(action, targetId) {
      fetch("MatchServlet", {
        method: "POST", 
        headers: {
        	"Content-Type": "application/x-www-form-urlencoded",
        },
		body: `action=${action}&targetId=${targetId}`
      })
        .then((res) => res.text())
        .then((data) => {
          console.log("å¾Œç«¯æœ‰å›æ‡‰å–”ï¼");
        })
        .catch((err) => {
          console.error("éŒ¯èª¤ç™¼ç”Ÿï¼š", err);
        });
    }
    
   

    
 	// å–å¾—èŠå¤©å®¤æ¸…å–®è³‡æ–™ä¸¦é¡¯ç¤ºåœ¨ç•«é¢ä¸Š
    function loadChatRooms(){
   	 fetch("ChatRoomListServlet")
   	 	.then(res => res.json())
   	 	.then(data => {
   	 		const ul = document.getElementById("chat-list");
   	 		ul.innerHTML = ""; // æ¸…ç©ºèˆŠçš„æ¸…å–®
   	 		
   	 		data.forEach(room => {
   	 			const otherId = (room.user1Id === currentUserId) ? room.user2Id : room.user1Id;
   			 	const otherName = userMap[otherId]?.name || "æœªçŸ¥";
   			 	const avatar = userMap[otherId]?.avatar || "default.jpg";
   			 	const li = document.createElement("li");
	   			li.classList.add("chat-item");
	   			li.dataset.roomid = room.roomId;
	   			li.dataset.name = otherName;
	   			li.onclick = () => handleRoomClick(room.roomId);
	
	   			li.innerHTML = `
	   			  <img src="img/${avatar}" />
	   			  <div class="chat-list-txt">
	   			      <h3>${otherName}</h3>
	   			      <p>è¼‰å…¥ä¸­...</p>
	   			  </div>
	   			`;
	   			ul.appendChild(li);
   	 			});
   	 	})
   	 	.catch(error => {
   	 		console.error("è¼‰å…¥èŠå¤©å®¤æ™‚å‡ºéŒ¯:", error);
   	 	});
    }
 	
    function handleRoomClick(roomId) {
    	  console.log("ä½¿ç”¨è€…é»äº†èŠå¤©å®¤, roomId :", roomId);

    	  fetch(`ChatMessageServlet?roomId=${roomId}`)
    	    .then(res => res.json())
    	    .then(data => {
    	      console.log("é€™å€‹èŠå¤©å®¤çš„è¨Šæ¯ï¼š", data);
    	      // ğŸ”œ é€™è£¡å¯ä»¥ä¹‹å¾Œæ¸²æŸ“è¨Šæ¯ç•«é¢
    	    })
    	    .catch(err => {
    	      console.error("è¼‰å…¥è¨Šæ¯æ™‚å‡ºéŒ¯ï¼š", err);
    	    });
    	}

 
 	// ä¸€æ‰“é–‹é é¢å°±è¼‰å…¥èŠå¤©å®¤æ¸…å–®
    window.addEventListener("DOMContentLoaded", loadChatRooms);
  </script>
</body>
</html>
